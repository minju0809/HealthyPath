<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <title>식품 검색</title>
  <style>
    /* 기본 스타일 */
    a {
        text-decoration: none;
        color: blue;
        margin: 0 5px;
    }

    /* 비활성화된 버튼 */
    a.disabled {
        pointer-events: none; /* 클릭 비활성화 */
        color: gray; /* 비활성화된 버튼 색상 */
    }

    /* 활성 페이지 */
    a.active {
        font-weight: bold;
        text-decoration: underline;
        color: darkblue;
    }

    /* 페이지네이션 컨테이너 스타일 */
    div.pagination {
        display: flex;
        justify-content: center;
        align-items: center;
        margin-top: 20px;
    }

    /* 페이지네이션 버튼 간격 */
    div.pagination a {
        padding: 5px 10px;
        border: 1px solid #ccc;
        border-radius: 4px;
    }

    div.pagination a:not(.disabled):hover {
        background-color: #f0f0f0;
    }
  </style>
</head>
<body>
  <div th:insert="~{fragments/header :: header}"></div>

  <h1>식품 검색</h1>
  
  <form th:action="@{/food/getFoods}" method="get">
    <select name="search_type">
      <option value="food_name" th:selected="${search_type == 'food_name'}">식품명</option>
      <option value="nutrient" th:selected="${search_type == 'nutrient'}">영양성분</option>
    </select>
    <input type="text" name="search_value" th:value="${original_search_value}">
    <button type="submit">검색</button>
  </form>

  <table>
    <thead>
      <tr>
        <th>식품명</th>
        <th>식품대분류명</th>
        <th>에너지(kcal)</th>
        <th th:if="${search_type == 'nutrient'}">영양성분 함량 기준량(g)</th>
        <th th:if="${search_type == 'nutrient'}" 
          th:text="${original_search_value + ' (' + search_value.substring(search_value.lastIndexOf('_') + 1) + ')'}">
        </th>
      </tr>
    </thead>
    <tbody>
      <tr th:if="${#lists.isEmpty(foods)}">
        <td colspan="5">검색 결과가 없습니다.</td>
      </tr>
      <tr th:each="food : ${foods}">
        <td th:text="${food.food_name}"></td>
        <td th:text="${food.major_category_name}"></td>
        <td th:text="${food.energy_kcal}"></td>
        <td th:if="${search_type == 'nutrient'}" th:text="${food.nutrient_reference_amount}"></td>
        <td th:if="${search_type == 'nutrient'}" th:text="${#numbers.formatDecimal(food[search_value], 1, 2)}"></td>
      </tr>
    </tbody>
  </table>

  <div class="pagination">
    <a th:href="@{/food/getFoods(search_type=${search_type}, search_value=${original_search_value}, page=1)}"
      th:classappend="${current_page == 1 || total_pages <= 1 || foods.isEmpty() ? 'disabled' : ''}">처음</a>

    <a th:href="@{/food/getFoods(search_type=${search_type}, search_value=${original_search_value}, page=${current_page != null && current_page > 1 ? current_page - 1 : 1})}"
      th:classappend="${current_page == 1 || total_pages <= 1 || foods.isEmpty() ? 'disabled' : ''}">이전</a>
    
    <th:block th:each="page_num : ${#numbers.sequence(start_page ?: 1, end_page ?: 1)}">
      <a th:href="@{/food/getFoods(search_type=${search_type}, search_value=${original_search_value}, page=${page_num})}"
          th:text="${page_num}"
          th:classappend="${(current_page ?: 1) == page_num ? 'active' : ''}"></a>
    </th:block>
  
    <a th:href="@{/food/getFoods(search_type=${search_type}, search_value=${original_search_value}, page=${current_page != null ? current_page + 1 : 1})}"
      th:classappend="${current_page == total_pages ? 'disabled' : ''}">다음</a>
  
    <a th:href="@{/food/getFoods(search_type=${search_type}, search_value=${original_search_value}, page=${total_pages})}"
      th:classappend="${current_page == total_pages ? 'disabled' : ''}">마지막</a>
  </div>
  
  <div th:insert="~{fragments/footer :: footer}"></div>
</body>
</html>